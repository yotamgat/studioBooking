# 👨‍💼 מדריך פאנל ניהול מלא

## ✅ מה נבנה:

### 1. מערכת אימות מלאה
- התחברות ורישום
- הרשאות (לקוח/מנהל)
- הגנה על עמודים

### 2. פאנל ניהול למנהלים
- Dashboard עם סטטיסטיקות
- ניהול הזמנות
- חסימת שעות

---

## 🚀 התקנה:

### שלב 1: עדכן .env.local

ודא שיש לך:
```env
MONGODB_URI=mongodb://localhost:27017/studio-booking
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-long-secret-key-min-32-characters
```

### שלב 2: הרץ

```powershell
Remove-Item -Recurse -Force .next
npm run dev
```

---

## 🎭 יצירת משתמש מנהל:

### אופציה 1: דרך MongoDB Compass (מומלץ)

1. **פתח MongoDB Compass**
2. **התחבר ל-`studio-booking`**
3. **פתח Collection `users`**
4. **הירשם דרך האתר** (http://localhost:3000/auth/register)
5. **חזור ל-Compass**
6. **מצא את המשתמש שלך**
7. **ערוך** (לחץ על עיפרון)
8. **שנה `role`** מ-`"customer"` ל-`"admin"`
9. **שמור**

### אופציה 2: דרך MongoDB Shell

```javascript
use studio-booking

db.users.updateOne(
  { email: "admin@example.com" },
  { $set: { role: "admin" } }
)
```

---

## 📊 איך להשתמש בפאנל:

### 1. כניסה לפאנל

**גש ל:** http://localhost:3000/admin

**אם לא מחובר** → יעביר להתחברות  
**אם לא מנהל** → יעביר לדף הבית עם שגיאה  
**אם מנהל** → ייכנס לדשבורד!

---

### 2. Dashboard (סקירה כללית)

**מה תראה:**
- 📅 **הזמנות היום** - כמה הזמנות יש היום
- 📊 **הזמנות השבוע** - כמה הזמנות השבוע
- ⏳ **ממתינות לאישור** - הזמנות שצריך לאשר
- 💰 **הכנסות החודש** - סך ההכנסות מהזמנות ששולמו

**פעולות מהירות:**
- לחץ על "אשר הזמנות" → עבור להזמנות ממתינות
- לחץ על "כל ההזמנות" → רשימת כל ההזמנות
- לחץ על "חסימת שעות" → חסום שעות לתחזוקה

---

### 3. ניהול הזמנות

**גש ל:** http://localhost:3000/admin/bookings

**מה תראה:**
טבלה עם כל ההזמנות:
- מספר הזמנה
- שם הלקוח + אימייל
- שם החלל
- תאריך ושעה
- מספר משתתפים
- מחיר
- סטטוס (ממתין/מאושר/בוטל/הושלם)
- סטטוס תשלום (ממתין/שולם/הוחזר)
- **פעולות** - אישור/ביטול

**סינונים:**
- **לפי סטטוס:** הכל / ממתין / מאושר / הושלם / בוטל
- **לפי חלל:** הכל / חלל 1 / חלל 2

**פעולות על הזמנות:**

#### אישור הזמנה
1. מצא הזמנה עם סטטוס "ממתין"
2. לחץ **"אשר"**
3. אשר בחלון הקופץ
4. הסטטוס משתנה ל-"מאושר" ✅

#### ביטול הזמנה
1. מצא הזמנה (כל סטטוס חוץ מבוטל/הושלם)
2. לחץ **"בטל"**
3. אשר בחלון הקופץ
4. הסטטוס משתנה ל-"בוטל" ❌
5. השעה משתחררת אוטומטית!

---

### 4. חסימת שעות

**גש ל:** http://localhost:3000/admin/availability

**שימושים:**
- תחזוקה בחלל
- אירוע פרטי
- חופשה / סגירת החלל
- שיפוצים

**איך לחסום:**

1. **בחר חלל**
2. **בחר תאריך**
3. **בחר שעת התחלה** (למשל 14:00)
4. **בחר שעת סיום** (למשל 18:00)
5. **הוסף סיבה** (למשל: "תחזוקה שנתית")
6. **לחץ "חסום שעות"**

**מה קורה:**
- נוצרת "הזמנה" מיוחדת עם מחיר 0
- השעות האלה נחסמות ביומן
- לקוחות לא יכולים להזמין את השעות האלה
- תראה את זה ברשימת ההזמנות עם "מחיר: ₪0"

**⚠️ חשוב:**
אם יש כבר הזמנה בזמן הזה - תקבל שגיאה!
צריך לבטל את ההזמנה הקיימת קודם.

---

## 🔍 תרחישי שימוש:

### תרחיש 1: אישור הזמנה חדשה

1. לקוח יצר הזמנה באתר
2. המנהל נכנס ל-/admin
3. רואה "1 ממתינה לאישור"
4. לוחץ על "אשר הזמנות"
5. רואה את ההזמנה בטבלה
6. לוחץ "אשר"
7. ההזמנה מאושרת! ✅

### תרחיש 2: ביטול הזמנה

**סיטואציה:** לקוח ביקש לבטל

1. נכנס ל-/admin/bookings
2. מחפש את ההזמנה (לפי תאריך או שם)
3. לוחץ "בטל"
4. ההזמנה מתבטלת
5. השעה משתחררת ביומן ✅

### תרחיש 3: חסימת שעות לתחזוקה

**סיטואציה:** תחזוקה שנתית ב-15 במרץ, 09:00-13:00

1. נכנס ל-/admin/availability
2. בוחר את החלל
3. תאריך: 15/03/2026
4. שעת התחלה: 09:00
5. שעת סיום: 13:00
6. סיבה: "תחזוקה שנתית"
7. לוחץ "חסום שעות"
8. השעות האלה חסומות! 🔒

### תרחיש 4: צפייה בהכנסות

1. נכנס ל-/admin
2. רואה "הכנסות החודש: ₪5,280"
3. זה סכום ההזמנות ששולמו החודש
4. (כרגע כל ההכנסות 0 כי אין תשלומים אמיתיים)

---

## 📋 רשימת בדיקות:

### בדיקה 1: גישה לפאנל

- [ ] לקוח רגיל לא יכול להיכנס ל-/admin
- [ ] מנהל יכול להיכנס ל-/admin
- [ ] לא מחובר מועבר להתחברות

### בדיקה 2: אישור הזמנות

- [ ] יצירת הזמנה חדשה
- [ ] ההזמנה מופיעה בפאנל עם סטטוס "ממתין"
- [ ] לחיצה על "אשר" משנה ל-"מאושר"
- [ ] מונה "ממתינות לאישור" יורד ב-1

### בדיקה 3: ביטול הזמנות

- [ ] לחיצה על "בטל" משנה ל-"בוטל"
- [ ] השעה משתחררת ביומן
- [ ] אפשר להזמין את השעה שוב

### בדיקה 4: חסימת שעות

- [ ] מילוי הטופס וחסימה
- [ ] השעות נעלמות מהיומן
- [ ] ניסיון להזמין את השעות נכשל
- [ ] ההזמנה מופיעה ברשימה עם מחיר 0

---

## 🎨 תכונות עתידיות (אפשר להוסיף):

### קלות יחסית:
- [ ] חיפוש הזמנות לפי שם לקוח
- [ ] ייצוא הזמנות ל-Excel/CSV
- [ ] הדפסת אישור הזמנה
- [ ] שליחת מייל ללקוח באישור/ביטול

### בינוניות:
- [ ] עריכת הזמנה (שינוי שעה/תאריך)
- [ ] הוספת הערות פנימיות להזמנה
- [ ] היסטוריית שינויים
- [ ] גרפים של הכנסות לאורך זמן

### מתקדמות:
- [ ] התראות פוש על הזמנות חדשות
- [ ] אפליקציה למובייל למנהלים
- [ ] ניהול מחירון דרך הפאנל
- [ ] העלאת תמונות חדשות לחללים

---

## ⚠️ שגיאות אפשריות:

### "אין הרשאה"
→ המשתמש לא מנהל. עדכן ב-MongoDB Compass

### "חסימה נכשלה - קיימת הזמנה"
→ יש הזמנה בזמן הזה. בטל אותה קודם

### הפאנל לא נטען
→ בדוק שהמשתמש מחובר ושה-role שלו הוא "admin"

---

## 🔒 אבטחה:

✅ רק מנהלים יכולים לגשת ל-/admin/*  
✅ כל API של מנהל בודק הרשאות  
✅ לקוחות רגילים לא רואים את הפאנל בכלל  

---

**הפאנל מוכן לשימוש!** 🎉

**מה הלאה?**
- תשלומים (Stripe/Tranzila)
- התראות במייל
- עמוד "ההזמנות שלי" ללקוחות

**שאלות? שאל!** 💬
