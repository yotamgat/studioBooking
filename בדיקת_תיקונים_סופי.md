# בדיקת כל התיקונים - גרסה 4

## מה תוקן:

### ✅ 1. תיקון זיהוי הזמנות קיימות
- ההזמנות עכשיו נשמרות במסד הנתונים
- בדיקת זמינות עובדת נכון
- לא ניתן להזמין פעמיים את אותה שעה

### ✅ 2. בחירת משתתפים לפי קבוצות
במקום להזין מספר חופשי, יש רשימה נפתחת:
- 1 אדם
- 2-4 אנשים
- 5-15 אנשים
- 16-25 אנשים
- 26+ אנשים

### ✅ 3. כפתור תשלום
בעמוד האישור יש כפתור "מעבר לתשלום" (כרגע מראה התראה, מאוחר יותר נחבר לסליקה)

### ✅ 4. יומן שבועי יפה
- תצוגה של שבוע שלם
- כל שעה מסומנת בירוק (פנוי) או אדום (תפוס)
- ניווט קל בין שבועות
- מראה בבירור מתי יש מקום ומתי לא

### ✅ 5. גלריית תמונות עם מעבר
- חיצים משני הצדדים
- מונה תמונות (1/3, 2/3...)
- החיצים מופיעים כשמרחפים מעל התמונה

---

## איך לבדוק:

### שלב 1: התקנת התלויות החדשות

```bash
npm install date-fns
```

### שלב 2: הרצת המערכת

```bash
npm run dev
```

### שלב 3: בדיקות

## בדיקה 1: גלריית תמונות

1. גש ל-http://localhost:3000/booking
2. בדף בחירת החלל, רחף מעל התמונה
3. **צריך לראות:**
   - חיצים משני הצדדים
   - מונה תמונות למטה (1/3, 2/3, 3/3)
   - לחיצה על החיצים מעבירה בין התמונות

## בדיקה 2: היומן השבועי

1. בחר חלל
2. עבור לשלב בחירת תאריך
3. **צריך לראות:**
   - יומן שבועי עם 7 ימים
   - כל יום מחולק לשעות (9:00-22:00)
   - נקודות ירוקות = פנוי
   - נקודות אדומות = תפוס
   - חיצים למעבר בין שבועות
   - כפתור "חזור להיום"

4. **נסה:**
   - לחץ על החיצים - עבור לשבוע הבא/קודם
   - לחץ "חזור להיום" - חוזר לשבוע הנוכחי
   - לחץ על יום - עובר לשלב הבא

## בדיקה 3: בחירת משתתפים

1. המשך לשלב פרטי ההזמנה
2. תחת "מספר משתתפים"
3. **צריך לראות:**
   - רשימה נפתחת (לא שדה מספר חופשי)
   - 5 אפשרויות: 1, 2-4, 5-15, 16-25, 26+

4. **בחר אפשרויות שונות:**
   - בחר "1 אדם" - המחיר צריך להיות 45 ש"ח/שעה (לא מסחרי)
   - בחר "5-15 אנשים" - המחיר צריך להיות 70 ש"ח/שעה (לא מסחרי)
   - בחר "26+ אנשים" - המחיר צריך להיות 110 ש"ח/שעה (לא מסחרי)

## בדיקה 4: שמירת הזמנות וזיהוי

**בדיקה ראשונה - יצירת הזמנה:**

1. בחר חלל, תאריך, ומלא פרטים:
   - תאריך: מחר
   - שעה: 10:00
   - משך: 2 שעות
   - משתתפים: 5-15 אנשים
   - סוג: אימון/שיעון
   - לא מסחרי

2. **צריך לראות:**
   - ✓ פנוי!
   - מחיר לשעה: 70 ש"ח
   - סה"כ: 140 ש"ח

3. לחץ "אישור והמשך לתשלום"

4. **צריך להגיע** לעמוד אישור עם:
   - סימן V ירוק
   - "ההזמנה נשמרה בהצלחה!"
   - כפתור "💳 מעבר לתשלום"

**בדיקה שנייה - ניסיון להזמין שוב:**

1. חזור לדף ההזמנה (או פתח טאב חדש)
2. בחר את **אותו חלל**
3. בחר את **אותו תאריך**
4. ביומן, **תראה** נקודות אדומות בשעות 10:00 ו-11:00 (תפוס!)
5. בחר את התאריך בכל זאת
6. מלא פרטים:
   - שעה: 10:00 (אותה שעה!)
   - משך: 1 שעה

7. **צריך לראות:**
   - ❌ לא פנוי בזמן הנבחר
   - "נסה שעה אחרת"
   - הכפתור "לא זמין" (אפור, לא ניתן ללחיצה)

**בדיקה שלישית - הזמנה בשעה אחרת:**

1. שנה שעה ל-**12:00** (אחרי ההזמנה הקיימת)
2. משך: 1 שעה

3. **צריך לראות:**
   - ✓ פנוי!
   - מחיר מחושב
   - כפתור "אישור והמשך לתשלום" פעיל

## בדיקה 5: כפתור תשלום

1. השלם הזמנה (כמו בבדיקה 4)
2. בעמוד האישור
3. **צריך לראות:**
   - כפתור ירוק גדול "💳 מעבר לתשלום"
   - לחץ עליו
   - **כרגע** יופיע alert: "כאן יתווסף קישור לסליקה"
   - מאוחר יותר נחבר את זה לטרנזילה/סליקה

---

## בדיקת היומן ב-MongoDB Compass

1. פתח MongoDB Compass
2. התחבר ל-`studio-booking`
3. פתח את האוסף `bookings`
4. **צריך לראות:**
   - מסמכים עם כל ההזמנות שיצרת
   - כל מסמך מכיל:
     - studioId
     - startTime, endTime
     - participants
     - activityType
     - isCommercial
     - totalPrice
     - status: "pending"
     - paymentStatus: "pending"

---

## שגיאות אפשריות:

### שגיאה: "date-fns is not defined"
**פתרון:**
```bash
npm install date-fns
```

### היומן לא טוען או מציג שגיאה
**בדוק:**
- הקונסול בדפדפן (F12)
- יש שגיאות ב-Network tab?
- ה-API `/api/bookings/day-availability` מחזיר תשובה?

### התמונות לא מתחלפות
**בדוק:**
- יש יותר מתמונה אחת בחלל?
- MongoDB Compass → studios → images (צריך להיות מערך עם 3 URLs)

---

## צ'קליסט סופי:

- [ ] גלריית תמונות עובדת (חיצים + מונה)
- [ ] יומן שבועי מוצג בצורה יפה
- [ ] נקודות ירוקות/אדומות ברורות
- [ ] בחירת משתתפים מרשימה (לא שדה חופשי)
- [ ] לא ניתן להזמין פעמיים את אותה שעה
- [ ] היומן מראה בצורה נכונה מה פנוי ומה תפוס
- [ ] כפתור "מעבר לתשלום" מופיע בעמוד האישור
- [ ] ההזמנות נשמרות ב-MongoDB

---

**אם הכל עובד - מעולה! המערכת כמעט מוכנה** 🎉

**הצעד הבא:** חיבור לסליקה (טרנזילה/Stripe) לתשלומים אמיתיים
