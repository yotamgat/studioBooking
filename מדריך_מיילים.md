# 📧 מדריך הגדרת שליחת מיילים

## תכונה חדשה: שליחת מייל אישור אוטומטי

כעת המערכת שולחת מייל אישור ללקוח אוטומטית לאחר ביצוע הזמנה! ✅

---

## 🚀 התקנה

### 1. התקן את החבילות הנדרשות:

```bash
npm install nodemailer
npm install --save-dev @types/nodemailer
```

---

## ⚙️ הגדרת מייל Gmail (מומלץ)

### שלב 1: אפשר "App Password" ב-Gmail

1. **היכנס לחשבון Google** שלך
2. **לך ל-Security** (אבטחה): https://myaccount.google.com/security
3. **הפעל 2-Step Verification** (אימות דו-שלבי) אם עדיין לא הפעלת
4. **חפש "App passwords"** (סיסמאות אפליקציות)
5. **צור סיסמה חדשה:**
   - Select app: Other (Custom name)
   - שם: "Studio Booking"
   - לחץ Generate
6. **העתק את הסיסמה בת 16 התווים** (משהו כמו: `abcd efgh ijkl mnop`)

### שלב 2: עדכן את .env.local

צור קובץ `.env.local` (או ערוך את הקיים) והוסף:

```env
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=abcd efgh ijkl mnop
```

**החלף:**
- `your-email@gmail.com` → המייל האמיתי שלך
- `abcd efgh ijkl mnop` → הסיסמה שיצרת בשלב הקודם

---

## 📮 ספקי מייל אחרים

### Outlook/Hotmail

```env
EMAIL_USER=your-email@outlook.com
EMAIL_PASSWORD=your-password
```

עדכן את `/lib/email.ts`:
```typescript
const transporter = nodemailer.createTransport({
  host: 'smtp-mail.outlook.com',
  port: 587,
  secure: false,
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASSWORD,
  },
});
```

### Yahoo

```env
EMAIL_USER=your-email@yahoo.com
EMAIL_PASSWORD=your-app-password
```

עדכן את `/lib/email.ts`:
```typescript
const transporter = nodemailer.createTransport({
  host: 'smtp.mail.yahoo.com',
  port: 465,
  secure: true,
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASSWORD,
  },
});
```

### SMTP מותאם אישית

```env
EMAIL_USER=your-email@yourdomain.com
EMAIL_PASSWORD=your-password
```

עדכן את `/lib/email.ts`:
```typescript
const transporter = nodemailer.createTransport({
  host: 'smtp.yourdomain.com',
  port: 587,
  secure: false,
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASSWORD,
  },
});
```

---

## ✅ בדיקת התקנה

### אפשרות 1: בדיקה אוטומטית

הרץ את השרת:
```bash
npm run dev
```

במסוף, תראה הודעה:
```
✅ Email server is ready
```

### אפשרות 2: שלח מייל בדיקה

צור קובץ `test-email.ts` בתיקייה הראשית:

```typescript
import { sendBookingConfirmationEmail } from './lib/email';

async function test() {
  await sendBookingConfirmationEmail({
    customerName: 'יוסי לוי',
    customerEmail: 'your-test-email@gmail.com', // שנה למייל שלך!
    studioName: 'חלל ריקוד 1',
    studioAddress: 'רחוב הדוגמה 123, תל אביב',
    date: 'יום שלישי, 20 בפברואר 2026',
    startTime: '18:00',
    endTime: '20:00',
    duration: '2 שעות',
    participants: '5-15 אנשים',
    activityType: 'אימון/שיעון',
    totalPrice: 280,
    bookingId: 'test123',
  });
  console.log('✅ Test email sent!');
}

test();
```

הרץ:
```bash
npx ts-node test-email.ts
```

---

## 📬 תוכן המייל

המייל שנשלח ללקוח כולל:

### 📋 פרטי ההזמנה:
- ✅ שם החלל
- ✅ כתובת (אם קיימת)
- ✅ תאריך ושעות
- ✅ משך זמן
- ✅ מספר משתתפים
- ✅ סוג פעילות
- ✅ מחיר סופי

### 🚪 הוראות כניסה:
- מתי להגיע
- איך להיכנס
- מה כלול במחיר
- איך לנעול בסיום
- מספר לתמיכה

### 📌 מידע חשוב:
- להביא תעודה מזהה
- לשמור על נקיון
- מדיניות ביטולים

---

## 🎨 עיצוב המייל

המייל מעוצב בצורה מקצועית:
- ✅ עיצוב רספונסיבי (מתאים למובייל)
- ✅ צבעים של המותג (סגול)
- ✅ קריא ונקי
- ✅ כפתור CTA להזמנה נוספת

---

## 🔧 התאמה אישית

### שינוי תוכן המייל

ערוך את `/lib/email.ts` בשורות 60-250 (תבנית ה-HTML)

### שינוי הוראות כניסה

מצא את החלק:
```html
<div class="instructions">
  <h3>🚪 הוראות כניסה</h3>
  <ul>
    <li><strong>הגעה:</strong> אנא הגיעו 5 דקות לפני...</li>
```

ושנה לפי הצורך.

### הוספת כתובת לסטודיו

עדכן ב-MongoDB Compass:
```javascript
db.studios.updateOne(
  { name: "חלל ריקוד 1" },
  { $set: { address: "רחוב הדוגמה 123, תל אביב" } }
)
```

---

## ⚠️ בעיות נפוצות

### "Error: Invalid login"
**פתרון:** ודא שהסיסמה היא App Password ולא הסיסמה הרגילה של Gmail

### "Error: Missing credentials"
**פתרון:** ודא ש-EMAIL_USER ו-EMAIL_PASSWORD מוגדרים ב-.env.local

### "Email not sending"
**פתרון:** 
1. בדוק את הקונסול אם יש שגיאות
2. ודא שה-App Password נכון
3. נסה להריץ `npx ts-node test-email.ts`

### המייל נכנס לספאם
**פתרון:**
1. השתמש בכתובת מייל עם דומיין משלך (לא Gmail)
2. הגדר SPF ו-DKIM records
3. שלח מספר מיילים "לגיטימיים" קודם

---

## 🚦 סטטוס המייל

המערכת תמשיך לעבוד גם אם המייל נכשל!

כלומר:
- ✅ ההזמנה **תישמר** גם אם המייל נכשל
- ✅ המשתמש **יקבל אישור** במערכת
- ❌ פשוט לא יקבל מייל

השגיאה תירשם בקונסול:
```
❌ Error sending email: [error details]
```

---

## 📊 מעקב אחרי מיילים

כדי לעקוב אחרי מיילים שנשלחו, אפשר:

1. **Gmail:** Sent folder
2. **Logs:** בדוק את קונסול השרver
3. **עתידי:** שילוב עם שירות כמו SendGrid/Mailgun

---

## 🎯 שלבים הבאים (אופציונלי)

1. **שירותי מייל מקצועיים:**
   - SendGrid (99 מיילים בחינם ליום)
   - Mailgun (5,000 מיילים בחינם לחודש)
   - Amazon SES (זול מאוד)

2. **תבניות מתקדמות:**
   - Handlebars templates
   - React Email
   - MJML

3. **מיילים נוספים:**
   - תזכורת 24 שעות לפני
   - מייל תודה אחרי השימוש
   - מייל ביטול

---

**המייל מוכן לשימוש! צריך רק להגדיר את פרטי ה-Gmail ב-.env.local** ✅

